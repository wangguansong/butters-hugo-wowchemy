---
title: 10.12 正则化
summary: >
  第 364-367 页。对梯度提升模型的正则化，可以通过交叉验证或早停法确定合适的循环次数；可以类比岭回归而引入“学习率”；可以类比自助聚合而得到随机梯度提升方法。

date: 2019-01-31T16:22:00+08:00
lastmod: 2022-06-14T15:41:00+08:00

weight: 1012

---

除了成分树模型的大小 $J$ 外，梯度提升方法的另一个超（meta）参数是提升循环的次数 $M$。每次循环通常可以降低训练集上的损失 $L(f_M)$，因而只要 $M$ 足够大，可以将这个损失降低到任意小。不过对训练数据过好的拟合会导致过拟合，这使模型对未来数据预测的损失增大。因此，存在一个最小化未来损失的最优循环次数 $M^\*$，它依赖于具体的应用场景。估计 $M^\*$ 的一个方便方法是在验证样本上构建出预测损失作为 $M$ 的函数。那么将这个损失最小化的 $M$ 取值作为对 $M^\*$ 的估计。这可类比于在神经网络中通常使用的早停法（[第 11.4 节]({{< relref "../ch11/ch11_04.md" >}})）。

### 10.12.1 收缩

控制 $M$ 的取值并不是唯一可行的正则化方法。如同岭回归（ridge regression）和神经网络，也可以应用收缩（shrinkage）方法（见[第 3.4.1 节]({{< relref "../ch03/ch03_04.md#341-岭回归" >}})和 [第 11.5 节]({{< relref "../ch11/ch11_05.md" >}})）。在提升方法的框架中，收缩方法的最简单实现是将每个树模型的贡献在加入到当前函数近似时，按因子 $0<\nu<1$ 进行缩小。也就是将[算法 10.3]({{< relref "../ch10/ch10_10.md#算法-103-梯度树模型提升算法gradient-tree-boosting-algorithm" >}}) 中的第 2.4 行替换为：

{{< math >}}
$$f_m(x) = f_{m-1}(x) +
\nu \cdot \sum_{j=1}^J \gamma_{jm} I(x \in R_{jm}) \tag{10.41}$$
{{< /math >}}

参数 $\nu$ 可被理解为控制了提升方法的学习率（learning rate）。较小的 $\nu$ 值（较大的收缩）会在同样循环次数 $M$ 下导致更大的训练集损失。因此，$\nu$ 和 $M$ 都控制了训练集上的预测损失。然而这两个参数的效果并不独立。若要达到同样的训练集损失，较小的 $\nu$ 值要对应着较大的 $M$ 值，所以在两者之间存在一个权衡。

从实践经验中（Friedman, 2001）发现，较小的 $\nu$ 值可能得出更佳的测试集误差，并且同时也对应地要求更大的 $M$ 值。实际上，最佳的策略是设置 $\nu$ 为一个很小的值（$\nu<0.1$）然后再用早停法来选择 $M$。这在回归和概率估计中都带来了巨大的改进（相对于无收缩 $\nu=1$）。在通过式 10.20 的误分类损失上对应的改进没有那么巨大，但仍然是显著的。这些改进需要在计算量上付出一定代价：较小的 $\nu$ 值会导致较大的 $M$ 值，而计算量是与后者成比例的。不过如下面所述，即使在很大的数据集上，大循环次数也一般在计算量上是可行的。其部分原因就是在每步中进行的是一个较小的树模型而且不需要剪枝。

{{< figure
  id="f1011"
  src="https://public.guansong.wang/eslii/ch10/eslii_fig_10_11.png"
  title="**图 10.11**：图 10.9 中的模拟例子（式 10.2）中的梯度提升方法（MART）的测试误差曲线。用二项偏差拟合模型，其中的场景包括了使用树桩模型或六个终节点的树模型，以及存在收缩或不存在收缩。左侧为测试集上的偏差，右侧为误分类误差。在所有的图中均可见收缩带来的好处，尤其是在左侧的偏差曲线中。"
>}}

[图 10.11](#figure-f1011) 展示了[图 10.2]({{< relref "../ch10/_index.md#figure-f1002" >}}) 中的模拟例子（式 10.2）的测试误差曲线。用二项偏差训练了梯度提升模型（MART），其中的场景包括了使用树桩模型或六个终节点的树模型，以及存在收缩或不存在收缩。可明显看出收缩带来的好处，尤其是在二项偏差的曲线中。使用了收缩后，每个测试误差曲线都达到了一个较低的水平，并且在之后的循环中保持在这个水平上。

[第 16.2.1 节]({{< relref "../ch16/ch16_02.md#1621-惩罚回归" >}})建立了提升方法的前向分段收缩和使用 $L_1$ 惩罚项对模型参数正则化（套索，lasso）两者之间的联系。作者认为 $L_1$ 的惩罚项可能要优于诸如支持向量机的方法中所使用的 $L_2$ 惩罚项。

### 10.12.2 子抽样 Subsampling

[第 8.7 节]({{< relref "../ch08/ch08_07.md" >}})中介绍了自助聚合（bagging）通过取平均的方式可改进噪声较高的分类器的效果。[第十五章]({{< relref "../ch15/_index.md" >}})会更细致地介绍这种抽样后再平均的方差缩减方法。在梯度提升方法中可采取同样的方式，在改进效果的同时也可改善计算效率。

**随机梯度提升**（stochastic gradient boosting）方法中（Friedman, 1999），在每步循环时从训练观测样本中以比例 $\eta$ 进行（无放回）抽样，并在这个子样本上生成下一个树模型。算法的其他部分保持不变。比例 $\eta$ 通常采用 $\frac{1}{2}$，不过对比较大的 $N$，$\eta$ 可以是比 $\frac{1}{2}$ 小得多的值。

这样的抽样不仅可将计算时间按同样的比例 $\eta$ 缩短，在很多场景中实际上也会得出更准确的模型。

{{< figure
  id="f1012"
  src="https://public.guansong.wang/eslii/ch10/eslii_fig_10_12.png"
  title="**图 10.12**：在模拟例子（式 10.2）上的测试误差曲线，来演示随机抽样的效果。标记为“$Sample=0.5$”的曲线，表示了在每次生成树模型时采用的是训练集不同的 50% 的子样本。左侧为基于二项偏差损失函数用 `gbm` 程序包拟合的模型；右侧为基于平方误差损失函数。"
>}}

[图 10.12](#figure-f1012) 演示了在模拟例子（式 10.2）上子抽样的效果，其中包含了分类问题和回归问题的示例。在两个场景中都可见结合了收缩和抽样的模型的表现稍微好于其他模型。而不进行收缩的子抽样模型表现不佳。

这个方法带来一个不利是现在模型中有四个待定的参数：$J$、$M$、$\nu$ 和 $\eta$。一般会通过一些前期考察来确定 $J$、$\nu$ 和 $\eta$ 的适当取值，只剩 $M$ 作为首要的参数。